<div class="product-page">
  <div class="product-thumbnails">
    {% for image in product.images limit: 3 %}
      <img
        src="{{ image | image_url }}"
        alt="{{ product.title }}"
        class="thumbnail-image">
    {% endfor %}
  </div>

  <div class="product-image">
    <img src="{{ product.featured_image | image_url }}" alt="{{ product.title }}">
  </div>

  <div class="product-details">
    <div class="product-rating">
      <span>⭐⭐⭐⭐⭐ 365 avaliações</span>
      <span>{{ product.reviews_count }} avaliações</span>
    </div>

    <h1>{{ product.title }}</h1>

    <div id="product-description" class="product-description"></div>

    <div class="product-price">
      {% if product.compare_at_price > product.price %}
        <span class="old-price">{{ product.compare_at_price | money }}</span>
      {% endif %}
      <span class="price">{{ product.price | money }}
        <p class="a-vista">à vista</p>
      </span>
    </div>

    <div class="installments">
      <p id="installments-text"></p>
    </div>

    <button class="buy-button" onclick="addToCart({{ product.id }}, 1)">Comprar</button>

    <div class="bagaço-do-frete">
      <label for="cep">Calcular Frete:</label>
      <div class="frete">
        <input
          type="text"
          id="cep"
          placeholder="Digite seu CEP">
        <button>OK</button>
      </div>
    </div>
  </div>
</div>


<div class="product-banners-final">
  {% assign last_images = product.images | slice: -5 %}
  {% for image in last_images %}
    {% if image != blank %}
      <div class="product-apresentation">
        <img src="{{ image | image_url }}" alt="{{ product.title }}">
        {% case forloop.index %}
          {% when 1 %}
            <p>Frase Genérica para a primeira imagem.</p>
          {% when 2 %}
            <p>Frase Genérica para a segunda imagem.</p>
          {% when 3 %}
            <p>Frase Genérica para a terceira imagem.</p>
        {% endcase %}
      </div>
    {% endif %}
  {% endfor %}

  <div class="ideal_para_você_title">
    <h2>2 em 1 - aspirador & passa pano</h2>
  </div>
  <div class="ideal_para_você">
    {% assign handles = "roomba-combo-essential-v,roomba-i5,roomba-i5-plus,roomba-j5,roomba-combo-j7,roomba-combo-j7-plus,roomba-combo-essential-g,roomba-j7,roomba-j7-plus,produto-10,produto-11" | split: "," %}
    {% for handle in handles %}
      {% assign prod = all_products[handle] %}
      {% if prod %}
        {% assign index = forloop.index %}
        {% assign key = "imagem_" | append: index %}
        {% assign imagem_dinamica = section.settings[key] %}
        <div class="ideal_para_você_containers">
          <a href="{{ prod.url }}">
            {% if imagem_dinamica %}
              <img src="{{ imagem_dinamica | image_url }}" alt="Imagem dinâmica {{ index }}">
            {% else %}
              <img src="{{ 'placeholder.png' | asset_url }}" alt="Sem imagem">
            {% endif %}
          </a>
          <a href="{{ prod.url }}">{{ prod.title }}</a>
          <div class="ideal_small_containers">
            {% assign linhas = (1..20) %}
            {% for j in linhas %}
              {% if j == 1 %}
                <div class="small_small_container_ideal_green"><p>Reservatório<br>Hibrido</p></div>
              {% elsif j == 2 %}
                <div class="small_small_container_ideal_green"><p>Padrão</p></div>
              {% elsif j > 2 and j <= 14 %}
                <div class="small_small_container_ideal_green"><p>✔</p></div>
              {% else %}
                <div class="small_small_container_ideal_not_green"><p> </p></div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      {% endif %}
    {% endfor %}
  </div>

<script>
  var productPrice = {{ product.price | divided_by: 100 }};
  var maxInstallments = 6;
  var maxInstallments10 = 10;
  var installmentText = document.getElementById('installments-text');
  var productDescription = `{{ product.description | raw }}`;
  var firstBreak = productDescription.indexOf('<br>');
  
  if (firstBreak !== -1) {
    productDescription = productDescription.substring(0, firstBreak);
  }
  document.getElementById('product-description').innerHTML = productDescription;
  
  function calculateInstallments(price, maxInstallments, maxInstallments10) {
    if (isNaN(price) || price <= 0) {
      return 'Parcelamento não disponível';
    }
    var installmentValue6x = (price / maxInstallments).toFixed(2);
    var installmentValue10x = (price / maxInstallments10).toFixed(2);
    return `Em até ${maxInstallments}x de R$ ${installmentValue6x} sem juros<br> ou ${maxInstallments10}x de R$ ${installmentValue10x}`;
  }
  
  installmentText.innerHTML = calculateInstallments(productPrice, maxInstallments, maxInstallments10);
  
  var thumbnails = document.querySelectorAll('.thumbnail-image');
  thumbnails.forEach(function(thumbnail) {
    thumbnail.addEventListener('click', function() {
      var mainImage = document.querySelector('.product-image img');
      mainImage.src = thumbnail.src;
    });
  });
  
  function addToCart(productId, quantity) {
    var data = {
      items: [{
        id: productId,
        quantity: quantity
      }]
    };
  
    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => {
      console.log("enviado!")
    })
    .catch((error) => {
      console.error('Erro ao adicionar ao carrinho:', error);
    });
  }
</script>